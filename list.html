<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>I Want Crazyhouse - Current Tournaments</title>

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.13/semantic.min.css">

	<style>
		[v-cloak] {
			display: none;
		}
		
		.ui.table thead tr:first-child > th {
			position: sticky !important;
     		top: 0;
     		z-index: 2;
		}
		.tooltip {
			position: relative;
			display: inline-block;
		}

		.tooltip .tooltiptext {
			visibility: hidden;
			background-color: white;
			text-align: center;
			padding: 0px 0;

			/* Position the tooltip */
			position: absolute;
			z-index: 1;
			top: -5px;
		}

		.tooltip:hover .tooltiptext {
			visibility: visible;
		}
	</style>
	
	<style lang="scss" scoped>
		.loader {
		  border: 16px solid #f3f3f3;
		  border-top: 16px solid #3498db;
		  border-radius: 50%;
		  width: 36px;
		  height: 36px;
		  animation: spin 2s linear infinite;
		}

		@keyframes spin {
		  0% {
			transform: rotate(0deg);
		  }
		  100% {
			transform: rotate(360deg);
		  }
		}
	</style>

</head>
<body>

<h1 id="header1" class="ui header centered">
	<span v-cloak>{{ message }}</span>
</h1>
<div class="ui header centered">List of currently open tournaments organized by the ZH community and lichess:</div>


<div id="table1" class="ui celled padded table">
<div>

<div class="ui header centered">
	<table style="width:100%">
		<tr>		
			<td style="width:20%"></td>
			<td style="padding:4px 4px 4px 4px;background-color:#bce5dc">lichess</td>
			<td style="padding:4px 4px 4px 4px;background-color:#c0e5bc">undergroundzh1/2</td>
			<td style="padding:4px 4px 4px 4px;background-color:#e5bce4">thefinnisher</td>
			<td style="padding:4px 4px 4px 4px;background-color:#e5d2bc">cybershredder</td>
			<td style="padding:4px 4px 4px 4px;background-color:#bccde5">ofbc_nigeria</td>
			<td style="width:20%"></td>
		</tr>
		<tr>		
			<td style="width:20%"></td>
			<td style="padding:4px 4px 4px 4px;"><div v-if="loading3" style="margin: auto;" class="loader"></div></td>
			<td style="padding:4px 4px 4px 4px;"><div v-if="loading12" style="margin: auto;" class="loader"></div></td>
			<td style="padding:4px 4px 4px 4px;"><div v-if="loading5" style="margin: auto;" class="loader"></div></td>
			<td style="padding:4px 4px 4px 4px;"><div v-if="loading4" style="margin: auto;" class="loader"></div></td>
			<td style="padding:4px 4px 4px 4px;"><div v-if="loading6" style="margin: auto;" class="loader"></div></td>
			<td style="width:20%"></td>
		</tr>

	</table>
</div>

</div>
	<table id="table10" class="ui celled padded table">
		<thead>
			<tr>
				<th style="text-align:center">Tournament</th>
				<th style="text-align:center">Clock</th>
				<th style="text-align:center"># Players Joined</th>
				<!--th>variant</th-->
				<th style="text-align:center">Starts</th>
				<!--th>finishes at</th-->
				<th style="text-align:center">Duration (min)</th>
				<!--th>status</th-->
				<th style="text-align:center">Created by</th>
			</tr>
		</thead>
		
		<tbody>
			<tr v-for="tournament in tournaments" v-bind:style="'background-color:'+colorTournament(tournament)">
				<td class="single line">
					<a style="font-weight:bold;color:#0c58c9" v-bind:href="'https://lichess.org/tournament/' + tournament.json['id']">{{tournament.json['fullName']}}</a></span>
				</td>

				<td>
					<span v-cloak>{{(tournament.json['clock']['limit'])/60}} + {{tournament.json['clock']['increment']}}</span>
				</td>

				<td style="text-align:right">
					<span v-cloak>{{tournament.json['nbPlayers']}}</span>
				</td>
				<!--td>
					<span v-cloak>{{tournament.json['variant']['name']}}</span>
				</td-->
				<td description='asdf' class="tooltip">
					<span v-cloak>{{moment(new Date(tournament.json['startsAt'])).fromNow()}}</span>
					<div class="tooltiptext">
						<table style="width: 200pt;" border="0" bgcolor="#ffffff">
							<tbody>
							<tr>
								<td style="padding: 0pt; border-top: none;"><b>{{moment(new Date(tournament.json['startsAt'])).local()}}()</b></td>
							</tr>
							</tbody>
						</table>
					</div>
				</td>
				<!--td>
					<span v-cloak>{{new Date(tournament.json['finishesAt']).toLocaleString()}}</span>
				</td-->
				<td style="text-align:right">
					<span v-cloak>{{tournament.json['minutes']}}</span>
				</td>

				<!--td>
					<span v-cloak>{{tournament.json['status']}}</span>
				</td-->
				<td>
					<span v-cloak>{{tournament.json['createdBy']}}</span>
				</td>

			</tr>
		</tbody>

	</table>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.13/semantic.min.js"></script>
<script src="https://unpkg.com/vue"></script>

<script>
	
	var Tournament = function(json) {
		this.json = json;
	}

    var header1 = new Vue({
        el: '#header1',
        data: {
            message: 'I Want Crazyhouse!'
        }
    });
    
    var table1 = new Vue({
        el: '#table1',
        data: {
            //tournamentsTulpas: [],
            //tournamentsStarted: [],
            //tournamentsCreated: [],
            //tournamentsFinished: [],
            tournamentsTmp: [],
            tournaments: [],

            loading12: false,
            loading3: false,
            loading4: false,
            loading5: false,
            loading6: false
        },
        created: async function() {

			

			outerThis = this;
			outerThis.$data.loading12 = true;
			///////////////////
			let r1 = fetch( "https://lichess.org/api/user/undergroundzh1/tournament/created" ).then( function( response ) {
				if ( !response.ok ) {
					console.log(response);
					response.text().then(body => console.log(body));
					throw new Exception( response.status )
				}
				return response.text()
			}).then( function( text ) {
				var json = JSON.parse('['+text.split("}\n{").join("},{")+']');//oh fuck off NDJSON! because comma is not cool enough? TODO:how do i parse this shit properly
				for (var x in json){
					if (json[x]["status"] != 30 ) {
						outerThis.$data.tournaments.push(new Tournament(json[x]));
					}
				}
			}).then ( function(){
				outerThis.$data.tournaments.sort(function(a, b){return a.json['startsAt']-b.json['startsAt']});
			}).catch( function( error ) {
				console.info( "Received error ", error);
			});
				
			///////////////////////////////////
			let r2 = fetch( "https://lichess.org/api/user/undergroundzh2/tournament/created" ).then( function( response ) {
				if ( !response.ok ) {
					console.log(response);
					response.text().then(body => console.log(body));
					throw new Exception( response.status )
				}
				return response.text()
			}).then( function( text ) {
				var json = JSON.parse('['+text.split("}\n{").join("},{")+']');//oh fuck off NDJSON! because comma is not cool enough? TODO:how do i parse this shit properly
				for (var x in json){
					if (json[x]["status"] != 30 ) {
						outerThis.$data.tournaments.push(new Tournament(json[x]));
					}
				}
			}).then ( function(){
				outerThis.$data.tournaments.sort(function(a, b){return a.json['startsAt']-b.json['startsAt']});
			}).catch( function( error ) {
				console.info( "Received error ", error);
			});
			///////////////////////////////////
			let r22 = fetch( "https://lichess.org/api/user/blunderman1/tournament/created" ).then( function( response ) {
				if ( !response.ok ) {
					console.log(response);
					response.text().then(body => console.log(body));
					throw new Exception( response.status )
				}
				return response.text()
			}).then( function( text ) {
				var json = JSON.parse('['+text.split("}\n{").join("},{")+']');//oh fuck off NDJSON! because comma is not cool enough? TODO:how do i parse this shit properly
				for (var x in json){
					if (json[x]["status"] != 30 ) {
						outerThis.$data.tournaments.push(new Tournament(json[x]));
					}
				}
			}).then ( function(){
				outerThis.$data.tournaments.sort(function(a, b){return a.json['startsAt']-b.json['startsAt']});
			}).catch( function( error ) {
				console.info( "Received error ", error);
			});
			await r1;
			await r2;
			await r22;
			outerThis.$data.loading12 = false;
			
			//////////////
			outerThis.$data.loading3 = true;
			let r3 = fetch( "https://lichess.org/api/tournament" ).then( function( response ) {
				if ( !response.ok ) {
					console.log(response);
					response.text().then(body => console.log(body));
					throw new Exception( response.status )
				}
				return response.json()
			}).then( function( json ) {

				for (var x in json["started"]){
					var t = json["started"][x];
					//outerThis.$data.tournamentsStarted.push(new Tournament(t));
					if (t["variant"]["key"]=="crazyhouse"){
						outerThis.$data.tournaments.push(new Tournament(t));
					}
				}
				
				for (var x in json["created"]){
					var t = json["created"][x];
					//outerThis.$data.tournamentsCreated.push(new Tournament(t));
					if (t["variant"]["key"]=="crazyhouse"){
						outerThis.$data.tournaments.push(new Tournament(t));
					}
				}
				
			}).then ( function(){
				outerThis.$data.loading3 = false;
				outerThis.$data.tournaments.sort(function(a, b){return a.json['startsAt']-b.json['startsAt']});
			}).catch( function( error ) {
				console.info( "Received error ", error);
			});
			
			outerThis.$data.loading4 = true;
			/////////////////////////////
			let r4 = fetch( "https://lichess.org/api/user/CyberShredder/tournament/created" ).then( function( response ) {
				if ( !response.ok ) {
					console.log(response);
					response.text().then(body => console.log(body));
					throw new Exception( response.status )
				}
				return response.text()
			}).then( function( text ) {
				var json = JSON.parse('['+text.split("}\n{").join("},{")+']');//oh fuck off NDJSON! because comma is not cool enough? TODO:how do i parse this shit properly
				for (var x in json){
					if (json[x]["status"] != 30 && json[x]["variant"]["key"] == "crazyhouse") {
						outerThis.$data.tournaments.push(new Tournament(json[x]));
					}
				}
			}).then ( function(){
				outerThis.$data.tournaments.sort(function(a, b){return a.json['startsAt']-b.json['startsAt']});
				outerThis.$data.loading4 = false;
			}).catch( function( error ) {
				console.info( "Received error ", error);
			}).then (function(){
				//var tid = outerThis.$data.tournaments[0].json["id"];
			});

			await r3;
			await r4;
//


			///////////////////////////////////
			outerThis.$data.loading5 = true;
			let r5 = fetch( "https://lichess.org/api/user/TheFinnisher/tournament/created" ).then( function( response ) {
				if ( !response.ok ) {
					console.log(response);
					response.text().then(body => console.log(body));
					throw new Exception( response.status )
				}
				return response.text()
			}).then( function( text ) {
				var json = JSON.parse('['+text.split("}\n{").join("},{")+']');//oh fuck off NDJSON! because comma is not cool enough? TODO:how do i parse this shit properly
				for (var x in json){
					if (json[x]["status"] != 30 ) {
						outerThis.$data.tournaments.push(new Tournament(json[x]));
					}
				}
			}).then ( function(){
				outerThis.$data.loading5 = false;
				outerThis.$data.tournaments.sort(function(a, b){return a.json['startsAt']-b.json['startsAt']});
			}).catch( function( error ) {
				console.info( "Received error ", error);
			});
				
			/////////////////////////////////
			outerThis.$data.loading6 = true;
			let r6 = fetch( "https://lichess.org/api/user/OFBC_Nigeria/tournament/created" ).then( function( response ) {
				if ( !response.ok ) {
					console.log(response);
					response.text().then(body => console.log(body));
					throw new Exception( response.status )
				}
				return response.text()
			}).then( function( text ) {
				var json = JSON.parse('['+text.split("}\n{").join("},{")+']');//oh fuck off NDJSON! because comma is not cool enough? TODO:how do i parse this shit properly
				for (var x in json){
					if (json[x]["status"] != 30 ) {
						outerThis.$data.tournaments.push(new Tournament(json[x]));
					}
				}
			}).then ( function(){
				outerThis.$data.loading6 = false;
				outerThis.$data.tournaments.sort(function(a, b){return a.json['startsAt']-b.json['startsAt']});
			}).catch( function( error ) {
				console.info( "Received error ", error);
			});
			await r5;
			await r6;

                
	//////////
                
				

				
                
        },
        mounted: function() {
		},
		updated(){
			//alert('Updated hook has been called');
		},
        methods: {
			    moment : moment,
			    colorTournament : function(t){
					if (t.json["createdBy"]=="lichess"){
						return "#bce5dc";
					}
					if (t.json["createdBy"]=="blunderman1"){
						return "#c0e5bc";
					}
					if (t.json["createdBy"]=="undergroundzh1"){
						return "#c0e5bc";
					}
					if (t.json["createdBy"]=="undergroundzh2"){
						return "#c0e5bc";
					}
					if (t.json["createdBy"]=="thefinnisher"){
						return "#e5bce4";
					}
					if (t.json["createdBy"]=="cybershredder"){
						return "#e5d2bc";
					}
					if (t.json["createdBy"]=="ofbc_nigeria"){
						return "#bccde5";
					}
					return "yellow";	
				}
        }
    });

</script>
</body>
</html>
